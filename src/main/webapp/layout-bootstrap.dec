<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<#import "/WEB-INF/macros/resource/common.ftl" as common><#t>
<#import "/WEB-INF/macros/header.ftl" as header>

    <head>
        <title>${title!siteName}</title>
        <#if authenticatedUser??>
	        <!-- logged-in-as: ${sessionData.person.email} -->
        </#if>
		<!-- BEGIN-PAGE-HEADER -->        
        <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
        <link rel="unapi-server" type="application/xml" title="unAPI" href="<@s.url value='/unapi'/>">
        <link rel="search" type="application/opensearchdescription+xml" href='<@s.url value="/opensearch.xml"/>' title="Search ${siteAcronym}"> 

		<#-- dev only 
        <script src="//ajax.aspnetcdn.com/ajax/modernizr/modernizr-2.0.6-development-only.js"></script>
        -->
		<script src="/includes/modernizr-custom-2.6.2.min.js"></script>
        
		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap.min.css" rel="stylesheet">
		<!--[if gt IE 8]><!--> <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen"> <!--<![endif]-->
		

        <link rel="stylesheet" type="text/css" href='//ajax.googleapis.com/ajax/libs/jqueryui/${jquery_ui_version}/themes/base/jquery-ui.css'>
        <link href="<@s.url value="/css/vc/${common.tdarBuildId}/tdar-base.css"/>" rel="stylesheet">
        <link href="<@s.url value="/css/vc/${common.tdarBuildId}/tdar-print.css"/>" rel="stylesheet" media="print">
        
        <script src="<@s.url value="/includes/tdar.core.js"/>"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/${jquery_version}/jquery.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/${jquery_ui_version}/jquery-ui.min.js"></script>

        <script type="text/javascript" src="//www.google.com/jsapi"></script>
        <#--end maps support -->
        <#include "${themeDir}/head.dec" />


    <#assign uri = request.requestURI />
    <#assign bodyid = 'home' />
    <#if (uri != '' && uri != '/')>
        <#assign bodyid = "alt" />
    </#if>
    <@header.css production />
        
    ${head}

    <@common.globalJavascript />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body id="${bodyid}" data-spy="scroll" data-target="#subnavbar" class="results ${actionName}">
    <div class="container">
        <div class="row">
            <header class="span12">
                <#include "${themeDir}/header.dec" />
                <#if (authenticatedUser??) > 

                    <p class="welcome no-print ">
                        Welcome back, <a href="">${authenticatedUser.properName}</a>
                    </p>
    
                    <div class="welcome-drop no-print ">
    
                        <p>${authenticatedUser.properName}</p>
    
                        <ul>
                            <li><a href="<@s.url value="/resource/add"/>">Upload a resource</a></li>
                            <li><a href="<@s.url value="/project/add"/>">Create a project</a></li>
                            <li><a href="<@s.url value="/collection/add"/>">Create a collection</a></li>
                            <li><a href="<@s.url value="/dashboard"/>">View my resources</a></li>
                            <li><a href="<@s.url value="/dashboard#bookmarks"/>">Bookmarks</a></li>
                        </ul>
    
                        <ul>
                            <#if administrator >
                                <li><a href="<@s.url value="/admin/searchindex/build"/>">reindex</a></li>
                            </#if>
                            <li><a href="<@s.url value='/entity/person/edit?id=${sessionData.person.id?c}'/>">Account Settings</a></li>
                            <li><a href="${commentUrlEscaped}?subject=tDAR%20comments">Contact Us</a></li>
                            <li><a href="<@s.url value="/logout"/>">Sign Out</a></li>
                        </ul>
                    </div>
                </#if>

                <nav >
                    <ul>
                        <#include "${themeDir}/nav-items.dec" />
                        <li class="button hidden-phone"><a href="<@s.url value="/search/results"/>">BROWSE</a></li>
                        <li class="button hidden-phone"><a href="<@s.url value="/resource/add"/>">UPLOAD</a></li>
                    </ul>
    
                    <#if bodyid != 'home'>
                        <form name="searchheader" action="<@s.url value="/search/results"/>" class="searchbox hidden-phone hidden-tablet no-print">
                            <input type="text" name="query" placeholder="Search..." >
                        </form>
                    </#if>
                </nav>
            </header>
    </div> 
<#if bodyid == 'home'>
        <div class="row">
            <div class="hero">
            <#include "${themeDir}/homepage-banner.dec" />
                <@common.loginMenu true/>
            </div>
            <ul class="inline-menu hidden-desktop"><@common.loginMenu false/></ul>
       </div>
            
            
            <#include "${themeDir}/homepage-column-one.dec" />
    
<#else>
<div class="row">
    <div class="span12 subnav">
        <ul class="subnav-lft">
            <li><a href="<@s.url value="/search"/>">Search</a></li>
            <li><a href="<@s.url value="/search/results"/>">Browse</a></li>
            <li><a href="<@s.url value="/browse/explore"/>">Explore</a></li>
              <#if sessionData?? && sessionData.authenticated>
	              <li><a href="<@s.url value="/dashboard"/>">Dashboard</a></li>
                  <li><a href="<@s.url value="/workspace/select-tables"/>">Integrate</a></li>
                <#if editor>
                    <li><a href="<@s.url value="/admin"/>">Admin</a></li>
                </#if>
            </#if>
        </ul>
        <@common.loginMenu true />
    </div>
</div>
<!-- BEGIN-TDAR-CONTENT -->



</#if>
    <#if  page.properties["div.toolbars"]?? && page.properties["div.toolbars"] != "">
    	<!-- toolbar -->
    	<div class="row">
        ${page.properties["div.toolbars"]}
        </div>
    </#if>
    

    <div class="row">
    <!-- action errors  fix me only show if visible -->
        <div class="span12">
            <#if  page.properties["div.messages"]?? && page.properties["div.messages"] != "">
                ${page.properties["div.messages"]}
            </#if>
            <@s.actionmessage theme="bootstrap" />
            <#if ((actionErrors![])?size > 0)>
            <h3>${siteAcronym} encountered the following problems with your submission</h3>
				<#-- fixme -- @s.actionerrors need to be here, but in some cases, it duplicates errors -->
            	<@s.actionerror theme="bootstrap" cssClass="action-errors" />
            <#if ((stackTraces![])?size > 0)>
            <a href="#" id="pToggleStackTrace" onclick="$('#stackTraceList').toggleClass('hidden');return false;" class="btn btn-mini btn-warning btn-invert">Show/Hide Details</a>
            <div id="stackTraceList" class="<#if production>hidden</#if>">
                <#list stackTraces as _stacktrace>
<#--don't indent this pre section  -->
<pre class="pre-scrollable">
<em>Stacktrace ${_stacktrace_index + 1} of ${stackTraces?size}</em><br />
${_stacktrace?html}
</pre>
                </#list>
            </div>
            </#if>
            </#if>
            <@s.fielderror theme="bootstrap" />
        </div>
    </div>

    <#assign part="" />
    <#assign spanSize = 12/>
    <#if  page.properties["div.sidebar-left"]?has_content ||  page.properties["div.sidebar-right"]?has_content >
        <#assign part="cols" />
        <#assign spanSize = 9/>
    <#elseif page.properties["div.sidebar-left"]?has_content && page.properties["div.sidebar-right"]?has_content >
        <#assign part="cols" />
        <#assign spanSize = 6/>
    </#if> 

    <#if lookupSource?has_content ><#assign part="searchresults" /></#if>
    <#if page.properties["div.titlebar"]?has_content>
        ${page.properties["div.titlebar"]}
    </#if>

    <section class="row ${part}">

        <#if page.properties["div.sidebar-left"]?has_content>
            <aside class="span3">
            ${page.properties["div.sidebar-left"]}
           </aside>
        </#if>

        <article class="span${spanSize} results" id="articleBody">
            <#--Keep in mind.your body is inside a div.span element. now would be a good time to review bootstrap grid layout conventions (esp. 'Nesting Columns') -->
            <#--http://twitter.github.com/bootstrap/scaffolding.html#gridSystem -->
            ${body}
        </article> 

        <#if page.properties["div.sidebar-right"]?has_content>
            <aside class="span3 sidebar <#if actionName=='edit' || actionName='add'>hidden-tablet hidden-phone</#if> <#if actionName=='view' &&  resource?has_content>${resource.resourceType?lower_case}-bg-large tdar-icon</#if>">
            ${page.properties["div.sidebar-right"]}
           </aside>
        </#if>
    </section>


</div>
    <!-- BEGIN-TDAR-FOOTER -->
    <footer>
        <div class="container">
            <#include "${themeDir}/footer.dec" />
            <div>
                <p><small>
                    build #: ${common.tdarBuildId}
                    <#if authenticatedUser??>
                       - logged in as: <a href="<@s.url value="/browse/creators/${sessionData.person.id?c}"/>">${sessionData.person.email}</a>
                    </#if>
                </small></p>
            </div>
        </div>

    </footer>
        <script src="//ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>        
        <#--TODO: decide whether it's wise to use a bootstrap CDN.  For now I'm using this for convenience -->
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>

        <script type="text/javascript">
        //functionality for "welcome back, so-and-so!" (pulled from main.js)
        //FIXME: needs refactoring
        $(function(){
            $(".welcome a").click(function(){
                $(".welcome-drop").toggle();
                return false;
            });
            
            $(document).click(function(){  
              $('.welcome-drop').hide();
            });
        });
        </script>
    <@header.scripts production />
    <script type="text/javascript">
    //this is temporary - our localhost v2 api key apparently incompatible with v3 api key.
    TDAR.maps.googleApiKey = "AIzaSyB532T66Gm5utEfPxiexOWhDc9tr2kyzsI";
    TDAR.maps.defaults.center.lat = ${mapDefaultLat};
    TDAR.maps.defaults.center.lng = ${mapDefaultLng};
    </script>
    <div id="ajaxIndicator" class="alert alert-info" style="display:none">Loading...</div>
    <#if !production || editor?has_content && editor>
		<script type="text/javascript" src="https://dev.tdar.org/jira/s/en_USgh0sw9-418945332/844/18/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=959f12a3"></script>
	</#if>
    </body>
</html>