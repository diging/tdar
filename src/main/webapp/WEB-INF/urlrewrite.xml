<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE urlrewrite
        PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
        "http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">
<urlrewrite>
    <rule>
        <name>XML Namespace Document</name>
        <note>
            The XML namespace URI for tDAR is
            "http://www.tdar.org/namespace". This namespace URI should never
            change. The following rule redirects from the namespace URI to a page
            where the namespace is currently documented. If the location of the
            documentation changes, the &lt;to&gt; element below should be updated
            to follow it.
        </note>
        <from>/namespace</from>
        <to type="temporary-redirect">http://dev.tdar.org/confluence/display/TDAR/tDAR+XML+namespace
        </to>
    </rule>

    <rule>
        <name>deal with annoying fishing excursions...</name>
        <from>/(wp|wordpress|old|blog|wp-admin|signup)/?.*</from>
        <to>/page-not-found</to>
        <!-- this does not work in Tomcat for some reason <set status="404" /> -->
    </rule>

    <rule>
        <from>^/services$</from>
        <to>/services/</to>
    </rule>

    <!-- <rule> <note>removing trailing bad request info from get request</note>
        <from>^/(document|dataset|project|image|coding-sheet|ontology|sensory-data)/(\d+)([^1234567890\?#/])(.*)</from>
        <to>/$1/$2</to> </rule> -->

    <rule>
        <from>^/register</from>
        <to>/account/new</to>
    </rule>

    <rule>
        <from>^/(account|cart)/add</from>
        <to>/$1/new</to>
    </rule>


    <rule>
        <from>^/(document)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=DOCUMENT&amp;startRecord=0
        </to>
    </rule>

    <rule>
        <from>^/(collection)s?/?$</from>
        <to type="redirect">/browse/collections</to>
    </rule>


    <rule>
        <from>^/filestore/?$</from>
        <to type="redirect">/</to>
    </rule>

    <rule>
        <from>^/(dataset)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=DATASET&amp;startRecord=0
        </to>
    </rule>

    <rule>
        <from>^/(coding-sheet)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=CODING_SHEET&amp;startRecord=0
        </to>
    </rule>
    <rule>
        <from>^/(ontology)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=ONTOLOGY&amp;startRecord=0
        </to>
    </rule>

    <rule>
        <from>^/(image)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=IMAGE&amp;startRecord=0</to>
    </rule>

    <rule>
        <from>^/(archive)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=ARCHIVE&amp;startRecord=0</to>
    </rule>

    <rule>
        <from>^/(project)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=PROJECT&amp;startRecord=0
        </to>
    </rule>

    <rule>
        <from>^/(audio)s?/?$</from>
        <to type="redirect">/search/results?resourceTypes=AUDIO&amp;startRecord=0</to>
    </rule>

    <rule>
        <from>^/admin/?$</from>
        <to>/admin/internal</to>
    </rule>

    <rule>
        <from>^/opensearch.xml$</from>
        <to>/opensearch</to>
    </rule>
    <rule>
        <from>^/robots.txt$</from>
        <to>/robots</to>
    </rule>

    <rule>
        <from>^/projects/list</from>
        <to>/dashboard/dashboard</to>
    </rule>

    <!-- support old rewrite -->
    <rule>
        <from>^/year-(\d+)$</from>
        <to type="temporary-redirect">/scholar/scholar?year=$1</to>
    </rule>

    <rule>
        <from>^/browse/(.+)/(\d+)/?$</from>
        <to>/browse/$1?id=$2</to>
    </rule>
    <outbound-rule>
        <from>^/browse/(.+)\?id=(\d+)$</from>
        <to>/browse/$1/$2</to>
    </outbound-rule>

    <rule>
        <from>^/browse/(.+)/(\d+)/rdf</from>
        <to>/browse/creatorRdf?id=$2</to>
    </rule>
    <outbound-rule>
        <from>^/browse/creatorRdf\?id=(\d+)$</from>
        <to>/browse/creators/$2/rdf</to>
    </outbound-rule>

    <rule>
        <from>^/filestore/(\d+)/([\w\-]+)</from>
        <to>/filestore/$2?informationResourceFileId=$1</to>
    </rule>

    <rule>
        <from>^/files/img/sm/(\d+)</from>
        <to>/filestore/thumbnail?informationResourceFileId=$1</to>
    </rule>

    <rule>
        <from>^/files/img/(md|lg)/(\d+)</from>
        <to>/filestore/$1?informationResourceFileId=$2</to>
    </rule>

    <rule>
        <from>^/filestore/(\d+)/?</from>
        <to>/filestore/get?informationResourceFileId=$1</to>
    </rule>

    <rule>
        <from>^/services//(.*)</from>
        <to>/services/$1</to>
    </rule>

    <rule>
        <condition type="request-uri" operator="equal">^/[^(services)].*$
        </condition>
        <from>^/(.+)/$</from>
        <to>/$1</to>
    </rule>
    <rule>
        <from>^/search/search(.*)</from>
        <to>/search/results$1</to>
    </rule>

    <!-- when run at the root context; the struts2 freemarker setup does not
        seem to properly route requests through the servlet; hence requests from
        http://localhost/ are routed to /about -->
    <rule>
        <from>^/$</from>
        <to>/about</to>
    </rule>

    <rule>
        <from>^/(search|advanced)/?$</from>
        <to>/search/basic</to>
    </rule>

    <rule>
        <from>^/sitemap/(.+)(\.(gz|xml))$</from>
        <to>/sitemap/sitemap?filename=$1$2</to>
    </rule>

    <rule>
        <from>^/sitemap([^/]+)$</from>
        <to>/sitemap/sitemap?filename=sitemap$1</to>
    </rule>

    <rule>
        <from>
            ^/(project|dataset|ontology|image|billing|audio|video|document|sensory-data|cart|coding-sheet|collection|archive|geospatial)/([0-9]+)/(admin|view|edit|upload|delete|columns|mapping|citations|dc|mods|json|xml|review|finalreview)\??(.*)$
        </from>
        <to>/$1/$3?id=$2</to>
        <!-- was &amp;$3 aat end -->
    </rule>
    <outbound-rule>
        <from>
            ^/(project|dataset|ontology|image|billing|audio|video|document|sensory-data|cart|coding-sheet|collection|archive|geospatial)/(admin|view|edit|xml|upload|delete|columns|citations|mapping|dc|mods|review|finalreview)\?id=([0-9]+)$
        </from>
        <to>/$1/$3/$2</to>
    </outbound-rule>
    <outbound-rule>
        <from>
            ^/(project|dataset|ontology|image|billing|audio|video|document|sensory-data|cart|coding-sheet|collection|archive|geospatial)/(admin|view|edit|xml|upload|delete|columns|citations|mapping|dc|mods|review|finalreview)\?id=([0-9]+)(.+)$
        </from>
        <to>/$1/$3/$2?$4</to>
    </outbound-rule>

    <rule>
        <from>^/ontology/([0-9]+)/([^\?]+)\??(.*)$</from>
        <to>/ontology/node?id=$1&amp;iri=$2&amp;$3</to>
    </rule>


    <rule>
        <from>^/(cart|billing)/([0-9]+)/(address|credit|simple|choose|polling|polling-check|review|finalreview)$
        </from>
        <to>/$1/$3?id=$2</to>
    </rule>
    <outbound-rule>
        <from>^/(cart|billing)/(address|credit|choose|simple|polling|polling-check|review|finalreview)\?id=([0-9]+)$
        </from>
        <to>/$1/$3/$2</to>
    </outbound-rule>

    <!-- XXX: could use this instead to deal with relative links (maybe) -->
    <!-- <outbound-rule> -->
    <!-- <from>(view|edit|upload|delete|columns|citations)\?id=([0-9]+)$</from> -->
    <!-- <to>$2/$1</to> -->
    <!-- </outbound-rule> -->

    <!-- all requests for a resource supplying just an id should go to it's
        view action -->
    <rule>
        <from>^/(project|dataset|ontology|billing|image|audio|video|document|cart|sensory-data|coding-sheet|collection|archive|geospatial)/([0-9]+)$
        </from>
        <to>/$1/view?id=$2</to>
    </rule>
    <outbound-rule>
        <from>^/(project|dataset|ontology|billing|image|audio|video|document|sensory-data|cart|coding-sheet|collection|archive|geospatial)/([0-9]+)/view$
        </from>
        <to>/$1/$2</to>
    </outbound-rule>

    <rule>
        <from>^/(dashboard)/?$</from>
        <to>/$1/$1</to>
    </rule>
    <outbound-rule>
        <from>^/(dashboard)/dashboard/?$</from>
        <to>/$1</to>
    </outbound-rule>

    <rule>
        <from>^/(login)/?$</from>
        <to>/$1/$1</to>
    </rule>
    <outbound-rule>
        <from>^/(login)/login/?$</from>
        <to>/$1</to>
    </outbound-rule>

    <rule>
        <from>^/(logout)/?$</from>
        <to>/login/$1</to>
    </rule>
    <outbound-rule>
        <from>^/login/logout/?$</from>
        <to>/logout</to>
    </outbound-rule>

    <outbound-rule>
        <from>^/browse/creators\?id=(\d+)(.*)</from>
        <to>/browse/creators/$1?$2</to>
    </outbound-rule>


    <!-- <rule> <from>^/document/add/([A-Z_]+)$</from> <to>/document/add?documentType=$1</to>
        </rule> <outbound-rule> <from>^/document/add\?documentType=([A-Z_]+)$</from>
        <to>/document/add/$1</to> </outbound-rule> -->
    <rule>
        <from>^/document/(source|related)/([0-9]+)$</from>
        <to>/document/$1?linkedResourceId=$2</to>
    </rule>

    <outbound-rule>
        <from>^/document/(source|related)\?linkedResourceId=([0-9]+)$</from>
        <to>/document/$1/$2</to>
    </outbound-rule>

    <rule>
        <from>^/resource/add/([0-9]+)$</from>
        <to>/resource/add?projectId=$1</to>
    </rule>

    <rule>
        <from>^/resource/([0-9]+)$</from>
        <to>/resource/view?resourceId=$1</to>
    </rule>

    <outbound-rule>
        <from>^/resource/add\?projectId=([0-9]+)$</from>
        <to>/resource/add/$1</to>
    </outbound-rule>

    <rule>
        <from>^/filestore/([0-9]+)$</from>
        <to>/filestore/$1/get</to>
    </rule>

    <outbound-rule>
        <from>^/filestore/([0-9]+)/get$</from>
        <to>/filestore/$1</to>
    </outbound-rule>

    <rule>
        <from>^/search$</from>
        <to>/search/basic</to>
    </rule>

    <rule>
        <from>^/account$</from>
        <to>/account/new</to>
    </rule>


    <rule>
        <name>remove version hash</name>
        <from>^(/[a-z]+)/vc/[0-9\.a-f]+/(.*)$</from>
        <to>/$1/$2</to>
    </rule>

    <rule>
        <from>^/workspace$</from>
        <to>/workspace/select-tables</to>
    </rule>
    <rule>
        <from>^/workspace/list$</from>
        <to>/workspace/select-tables</to>
    </rule>


    <rule>
        <from>^/entity/(person|user|institution)/([0-9]+)/(edit|address)$</from>
        <to>/entity/$1/$3?id=$2</to>
    </rule>
    <outbound-rule>
        <from>^/entity/(person|user|institution)/(edit|address)\?id=([0-9]+)$
        </from>
        <to>/entity/$1/$3/$2</to>
    </outbound-rule>


    <!-- http://stackoverflow.com/questions/962729/is-it-possible-to-disable-jsessionid-in-tomcat-servlet -->
    <outbound-rule encodefirst="true">
        <name>Strip URL Session ID's</name>
        <from>^(.*?)(?:\;jsessionid=[^\?#]*)?(\?[^#]*)?(#.*)?$</from>
        <to>$1$2$3</to>
    </outbound-rule>

    <!--  be careful with this where possible (it could have issues with things like the TAG Gateway)
    <outbound-rule>
        <from>^/(search|project|collection)/(.+)\.action\?(.*)$</from>
        <to>/$1/$2?$3</to>
    </outbound-rule>
    <outbound-rule>
        <from>^/(search|project|collection)/(.+)\.action$</from>
        <to>/$1/$2</to>
    </outbound-rule>
 -->

</urlrewrite>
