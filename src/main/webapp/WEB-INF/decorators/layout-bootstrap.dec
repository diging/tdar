<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" <#if ngApplicationName?has_content>ng-app="${ngApplicationName}"</#if>> <!--<![endif]-->
<#import "decorator-macros.ftl" as dec>
<#import "whitelabel-decorator-macros.ftl" as wdec>

<#global jquery_version="1.10.2">
<#global jquery_ui_version="1.8.23">
<#global jquery_ui_css_version="1.9.2">

<#-- if something bad happened, we're no-longer backed by TdarActionSupport, and thus protocol is not on the stack... switch to static error.
     This is a less-than ideal solution, but seems to be the best that we have. -->
<#if !(protocol?has_content)>
    <#include "/500.html" />
<#else>
    <#import "/WEB-INF/macros/resource/common.ftl" as common><#t>
    <#import "/WEB-INF/macros/header.ftl" as header>
    <#global qunit = (Parameters.qunit)??  && !production>
    <#assign uri = request.requestURI />
    <#assign bodyid = 'alt' />
    <#if (homepage!false)>
        <#assign bodyid = "home" />
    </#if>

<#-- avoid js in the header. if you must include it,  declare inline scripts, then external css, then external js -->
<head>
    <title>${title!siteName}</title>
    <#if authenticatedUser??>
        <!-- logged-in-as: ${authenticatedUser.email} -->
    </#if>
    <!-- BEGIN-PAGE-HEADER -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="unapi-server" type="application/xml" title="unAPI" href="<@s.url value='/unapi'/>">
    <link rel="search" type="application/opensearchdescription+xml" href='<@s.url value="/opensearch.xml"/>' title="Search ${siteAcronym}">

<#--  per: http://stackoverflow.com/questions/12246096/bootstrap-printing-width && https://github.com/netdna/bootstrap-cdn/pull/106 -->
    <#if useCDN>
        <link href="${protocol}//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link href="${protocol}//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" media="print">
        <link rel="stylesheet" type="text/css" href='${protocol}//ajax.googleapis.com/ajax/libs/jqueryui/${jquery_ui_css_version}/themes/base/jquery-ui.css'>
    <#else>
        <link href="${staticHost}/includes/bootstrap-2.32/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="${staticHost}/includes/bootstrap-2.32/css/bootstrap.min.css" rel="stylesheet">
        <link href="${staticHost}/includes/bootstrap-2.32/css/bootstrap.min.css" rel="stylesheet" media="print">
        <link rel="stylesheet" type="text/css" href='${staticHost}/includes/jquery-ui-${jquery_ui_css_version}/development-bundle/themes/base/jquery-ui.css'>
    </#if>

    <link href="${staticHost}/css/tdar-base.css" rel="stylesheet">
    <link href="${staticHost}/css/tdar-print.css" rel="stylesheet" media="print">
    <#if qunit>
        <link rel="stylesheet" href="/includes/qunit-1.11.0.css" type="text/css"></#if>
    <@header.css (webFilePreprocessingEnabled ) />

    <script>TDAR_jsErrorDelim = "${javascriptErrorLogDelimiter}?js_string";</script>

    <script type="text/javascript" src="${staticHost}/js/tdar.errorutils.js?build${common.tdarBuildId}"></script>
    <script src="${staticHost}/includes/modernizr-custom-2.6.2.min.js"></script>
    <#if useCDN>
        <script src="${protocol}//ajax.googleapis.com/ajax/libs/jquery/${jquery_version}/jquery.min.js"></script>
        <script src="${protocol}//ajax.googleapis.com/ajax/libs/jqueryui/${jquery_ui_version}/jquery-ui.min.js"></script>
    <#else>
        <script src="${staticHost}/includes/jquery-${jquery_version}.js"></script>
        <script src="${staticHost}/includes/jquery-ui-${jquery_ui_version}/ui/minified/jquery-ui.min.js"></script>
    </#if>
    <script type="text/javascript" src="${protocol}//www.google.com/jsapi"></script>
    <#include "/${themeDir}/head.dec" />
    <#if whiteLabelCollection??>  
        <link href="${staticHost}/css/whitelabel-default.css" rel="stylesheet" media="all">
    </#if>
    
${head}

    <@common.globalJavascript />

    <#if schemaOrgJsonLD?has_content>
        <script type="application/ld+json">
    ${schemaOrgJsonLD}

        </script>
    </#if>
    <#if base != ''>
    <base href="<@s.url value=''/>">
    </#if>
</head>
<body id="${bodyid}" data-spy="scroll" data-target="#subnavbar" class="results ${actionName} <#if !production>not-production</#if>"
    data-sessionTimeout="${sessionTimeout?c}" data-maxUploadFiles="${maxUploadFilesPerRecord?c}"
      <#if authenticatedUser?has_content>data-currentTime="1" </#if>
      <#if ngApplicationName?has_content>ng-cloak</#if>>
    <#if qunit>
    <div id="qunit"></div>
    <div id="qunit-fixture">
    </#if>
    <div class="container">
        <div class="row">
            <header class="span12">
                <@dec.layout_header />
            </header>
        </div>
        <#if (homepage!false)>
            <@dec.homepageHeader />
        </#if>

        <@dec.subnav />
            <!-- BEGIN-TDAR-CONTENT -->

        <#if  page.properties["div.toolbars"]?? && page.properties["div.toolbars"] != "">
            <!-- toolbar -->
            <div class="row">
            ${page.properties["div.toolbars"]}
            </div>
        </#if>

        <#if whitelableCollection??>
            <@wdec.searchHeader />
            <div class="container">
        </#if>


        <#if errorWarningSectionVisible >
            <div class="alert alert-error error-banner">
                <#if stackTraces?has_content>
                    <div class="error-codes pull-right">
                        <strong><@s.text name="error.action_error_codes"/></strong>
                        <#list stackTraces as code>
                            <span class="error-code">${code}</span>
                        </#list>
                    </div>
                </#if>
                <h4>${siteAcronym} <#if (resourceEditPage??)><@s.text name="error.action_resource_edit_error_header"/><#else><@s.text name="error.action_error_header"/></#if></h4>

                <div>
                    <@s.actionerror cssClass="action-errors" theme="simple" />
                    <#if historicalFileErrors?has_content>
                        <b><@s.text name="error.action_resource_edit_historical"/></b>
                        <ul>
                            <#list historicalFileErrors as fileError>
                                <li>${fileError.first.filename} ${(fileError.second.message)!"Unknown Error"}
                                    <#if fileError.second.errorCode?has_content>[${fileError.second.errorCode}]</#if></li>
                            </#list>
                        </ul>
                    </#if>

                    <@s.fielderror  cssClass="field-errors"  theme="simple"/>
                    <br/>
                    <#if moreInfoUrlKey?has_content>
                        <@s.text name="error.action_more_info_url" />
                        <a href="<@s.text value="${moreInfoUrlKey}"/>"><@s.text value="${moreInfoUrlKey}"/></a>
                    </#if>
                </div>
            </div>
        </#if>

        <#if actionMessages?has_content || (page.properties["div.messages"])?has_content>
            <div class="row">
                <div class="span12">
                    <@s.actionmessage />
        ${(page.properties["div.messages"])!}
                </div>
            </div>
        </#if>


        <#assign part="" />
        <#assign spanSize = 12/>
        <#if  page.properties["div.sidebar-left"]?has_content ||  page.properties["div.sidebar-right"]?has_content >
            <#assign part="cols" />
            <#assign spanSize = 9/>
        <#elseif page.properties["div.sidebar-left"]?has_content && page.properties["div.sidebar-right"]?has_content >
            <#assign part="cols" />
            <#assign spanSize = 6/>
        </#if>

    <#--FIXME: need a better way to hint to layout that we are rendering search results, or perhaps just use a separate layout file  -->
        <#if (lookupSource?? || actionName=='collections') ><#assign part="searchresults" /></#if>

        <#if page.properties["div.titlebar"]?has_content>
        ${page.properties["div.titlebar"]}
        </#if>

        <section class="row ${part}">

            <#if page.properties["div.sidebar-left"]?has_content>
                <aside class="span3">
                ${page.properties["div.sidebar-left"]}
                </aside>
            </#if>

            <article class="span${spanSize} results" id="articleBody">
            <#--Keep in mind.your body is inside a div.span element. now would be a good time to review bootstrap grid layout conventions (esp. 'Nesting Columns') -->
            <#--http://twitter.github.com/bootstrap/scaffolding.html#gridSystem -->
            ${body}
            </article>

            <#if page.properties["div.sidebar-right"]?has_content>
                <aside class="span3 sidebar <#if actionName=='edit' || actionName='add' || actionName='columns'>hidden-tablet hidden-phone</#if> <#if actionName=='view' &&  resource?has_content>${resource.resourceType?lower_case}-bg-large tdar-icon</#if>">
                ${page.properties["div.sidebar-right"]}
                </aside>
            </#if>
        </section>


    </div>
    <!-- BEGIN-TDAR-FOOTER -->
    <footer>
        <div class="container">
            <#include "/${themeDir}/footer.dec" />
            <div>
                <p>
                    <small>
                        <@s.text name="footer.build_num"/>: ${common.tdarBuildId}
                        <#if authenticatedUser??>
                            - <@s.text name="footer.logged_in_as"/>: <a
                                href="<@s.url value="/browse/creators/${authenticatedUser.id?c}"/>">${authenticatedUser.email}</a>
                        </#if>
                    </small>
                </p>
            </div>
        </div>

    </footer>

    <#if useCDN>
        <script src="${protocol}//ajax.aspnetcdn.com/ajax/jquery.validate/1.13.1/jquery.validate.min.js"></script>
        <script src="${protocol}//ajax.aspnetcdn.com/ajax/jquery.validate/1.13.1/additional-methods.min.js"></script>
        <script src="${protocol}//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <#else>
        <script src="${staticHost}/includes/jquery.validate-1.13.1/jquery.validate.js"></script>
        <script src="${staticHost}/includes/jquery.validate-1.13.1/additional-methods.js"></script>
        <script src="${staticHost}/includes/bootstrap-2.32/js/bootstrap.js"></script>
    </#if>


    <@header.scripts ( webFilePreprocessingEnabled) />
    <script type="text/javascript">
        TDAR.maps.googleApiKey = "${googleMapsApiKey!''}";
        TDAR.maps.defaults.center.lat = ${mapDefaultLat};
        TDAR.maps.defaults.center.lng = ${mapDefaultLng};
        TDAR.maps.defaults.isGeoLocationToBeUsed = ${geoLocationToBeUsed?string("true", "false")};
        <#--
         TDAR.maxUploadFiles = ${maxUploadFilesPerRecord?c};
         TDAR.common.sessionTimeout = ${sessionTimeout?c};
            <#if authenticatedUser?has_content>
            TDAR.common.currentTime = 1;
            </#if>
            -->
    </script>
    <div id="ajaxIndicator" class="alert alert-info" style="display:none">
        <strong class="statusLabel"></strong>
        <span class="statusMessage"></span>
    </div>
    <#if qunit>
        <script src="/includes/qunit-1.11.0.js"></script>
    </#if>

    <#if showJiraLink && jiraScriptLink?has_content && (!production || editor?has_content && editor) && !qunit>
        <script type="text/javascript">
            TDAR.loadScript('${protocol}//${jiraScriptLink}');
        </script>
    </#if>

    <#if qunit>
    <#-- close the test fixture div -->
    </div>
    <script src="/test/js/tdar.commontest.js"></script>
    <script src="/test/js<#if namespace != '/'>${namespace}</#if>/${actionName}.qunit.js"></script>
    </#if>
</#if>

</body>
</html>
