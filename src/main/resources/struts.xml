<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN" "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>
	<include file="struts-local-settings.xml" />
	<!-- performance enhancements -->
	<!-- freemarker cache -->
	<!-- <constant name='struts.freemarker.templatesCache' value='true'/> -->
	<constant name="struts.freemarker.mru.max.strong.size" value="250" />
	<constant name="struts.freemarker.templatesCache.updateDelay"
		value="60000" />
	<!-- javatemplates plugin, possible optimization for freemarker tags using 
		the simple theme. it may only work if you're using basic JSP struts tags 
		though, needs testing. -->
	<!-- <constant name="struts.ui.templateSuffix" value="java" /> -->
	<constant name="struts.ui.theme" value="tdar" />
	<constant name="struts.url.includeParams" value="none" />
	<constant name="struts.action.excludePattern" value="/services/.*" />
	<!-- set it to 50 MB to start with, using the ISI standard for megabyte, 
		i.e., 1,000,000 bytes -->
	<constant name="struts.multipart.maxSize" value="5368709120" />
	<!-- constant name="struts.enable.SlashesInActionNames" value="true"/> <constant 
		name="struts.mapper.alwaysSelectFullNamespace" value="false"/ -->
	<constant name="struts.patternMatcher"
		value="com.opensymphony.xwork2.util.NamedVariablePatternMatcher" />
	<package name="default" extends="struts-default" namespace="/">
		<result-types>
			<result-type name="jaxbdocument"
				class="org.tdar.struts.result.JaxbDocumentResult"></result-type>
		</result-types>
		<interceptors>
			<interceptor name="execAndWait"
				class="org.apache.struts2.interceptor.ExecuteAndWaitInterceptor" />
		</interceptors>
		<global-results>
			<result name="access-denied" type="redirect">/access-denied</result>
			<result name="login" type="redirect">/login</result>
			<result name="error" type="freemarker">/WEB-INF/content/error.ftl</result>
			<result name="exception" type="freemarker">/WEB-INF/content/exception.ftl
			</result>
			<result name="invalid.token" type="freemarker">/WEB-INF/content/double-submit.ftl
			</result>
		</global-results>
		<global-exception-mappings>
			<!-- XXX: can add more exception handlers for checked exceptions generated 
				from tDAR here. -->
			<exception-mapping exception="java.lang.Exception"
				result="exception" />
		</global-exception-mappings>
	</package>
	<package name="secured" extends="default" abstract="true">
		<interceptors>
			<interceptor name="authenticate"
				class="org.tdar.struts.interceptor.AuthenticationInterceptor" />
			<interceptor-stack name="editAuthenticatedStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="paramsPrepareParamsStack">
				    <param name="validation.validateAnnotatedMethodOnly">true</param>
				</interceptor-ref>
			</interceptor-stack>
			<interceptor-stack name="execWaitStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="paramsPrepareParamsStack" />
				<interceptor-ref name="execAndWait" />
			</interceptor-stack>
			<interceptor-stack name="basicAuthenticatedStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="basicStack" />
			</interceptor-stack>
			<interceptor-stack name="defaultAuthenticatedStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
			<interceptor-stack name="unAuthenticatedStack">
				<interceptor-ref name="paramsPrepareParamsStack" />
			</interceptor-stack>
		</interceptors>
		<default-interceptor-ref name="editAuthenticatedStack" />
	</package>
	<package name="secured-admin" extends="default" abstract="true">
		<interceptors>
			<interceptor name="authenticate"
				class="org.tdar.struts.interceptor.AdminAuthenticationInterceptor" />
			<interceptor-stack name="editAuthenticatedStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="paramsPrepareParamsStack" />
			</interceptor-stack>
			<interceptor-stack name="execWaitStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="paramsPrepareParamsStack" />
				<interceptor-ref name="execAndWait" />
			</interceptor-stack>
			<interceptor-stack name="basicAuthenticatedStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="basicStack" />
			</interceptor-stack>
			<interceptor-stack name="defaultAuthenticatedStack">
				<interceptor-ref name="authenticate" />
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
		</interceptors>
		<default-interceptor-ref name="editAuthenticatedStack" />
	</package>
</struts>
